Продолжаем погружение в тему application observability.

В среде, где запрос обрабатывается несколькими
приложениями очень важно иметь возможность быстро
найти логи из всех приложений относящиеся к
обработке конкретного запроса. Так как логов
очень много, то понять какой лог относится к
обработке запроса, а какой нет практически не
возможно.

Для решения этой задачи применяют следующий
подход. При получении запроса первым приложением,
приложение генерит случайное значение называемое
traceId и ассоциирует его с запросом.

"traceId":"bfb472c866e38083"

Далее при любом добавлении логов в них вставляется
ранее ассоциируемый с этим запросом traceId.

При вызове внешних интеграций, например REST в
посылаемый запрос в HTTP header вставляется
значение traceId.

На стороне принимающего запрос приложения traceId
достается из HTTP header и так же ассоциируется
с запросом. Это приложение тоже будет вставлять
traceId в свои логи.

Таким образом в систему логирования попадают
логи из всех приложений с дополнительным лейблом
traceId. Зная traceId запроса в общей системе
логов можно легко отыскать логи из всех приложений,
которые обрабатывали данный запрос.

Ваше задание: узнайте и подключите библиотеку
implementation('org.springframework.cloud:spring-cloud-starter-sleuth:3.1.11')
к приложениям Insurance Calculator, BlackList и Doc Generator.
Запустите все приложения с настроенным Elastic стеком
для сбора логов. Запустите REST запрос для расчета
страховой премии. Зайдите в логи любого приложения,
найдите там traceId запроса. Сделайте в Kibana запрос
к логам с указанием в поле фильтра traceId : "1fb2576cfa887332".
Убедитесь, что в найденных логах вы видите логи из
всех приложений.